# -*- coding: utf-8 -*-
"""
Hangman (Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¬Ù„ Ø§Ù„Ù…Ø´Ù†ÙˆÙ‚) - Ù†Ø³Ø®Ø© Ø·Ø±ÙÙŠØ© Terminal
Ù…ÙŠØ²Ø§Øª:
- Ù‚Ø§Ø¦Ù…Ø© ÙƒÙ„Ù…Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© + Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù…Ù† Ù…Ù„Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
- Ø±Ø³ÙˆÙ…Ø§Øª ASCII Ù„ÙƒÙ„ Ù…Ø­Ø§ÙˆÙ„Ø©
- ÙØ­Øµ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ (Ø­Ø±Ù ÙˆØ§Ø­Ø¯ØŒ Ø­Ø±Ù Ø£Ø¨Ø¬Ø¯ÙŠØŒ ØºÙŠØ± Ù…ÙØ¬Ø±ÙÙ‘Ø¨ Ù…Ù† Ù‚Ø¨Ù„)
- ÙŠØ­ØªÙØ¸ Ø¨Ø§Ù„Ø£Ø­Ø±Ù Ø§Ù„ØµØ­ÙŠØ­Ø© ÙˆØ§Ù„Ø®Ø§Ø·Ø¦Ø©
- Ø¹Ø¯Ø§Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙˆÙ…Ø­Ø§ÙˆÙ„Ø© Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
"""

import random
import os
import sys
import string

# --------- Ø±Ø³ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´Ù†Ù‚Ø© (Ù…Ù† 0 Ø­ØªÙ‰ Ø¢Ø®Ø± Ù…Ø­Ø§ÙˆÙ„Ø©) ----------
HANGMANPICS = [
    r"""
     +---+
     |   |
         |
         |
         |
         |
   =========""",
    r"""
     +---+
     |   |
     O   |
         |
         |
         |
   =========""",
    r"""
     +---+
     |   |
     O   |
     |   |
         |
         |
   =========""",
    r"""
     +---+
     |   |
     O   |
    /|   |
         |
         |
   =========""",
    r"""
     +---+
     |   |
     O   |
    /|\  |
         |
         |
   =========""",
    r"""
     +---+
     |   |
     O   |
    /|\  |
    /    |
         |
   =========""",
    r"""
     +---+
     |   |
     O   |
    /|\  |
    / \  |
         |
   ========="""
]

# --------- Ù‚Ø§Ø¦Ù…Ø© ÙƒÙ„Ù…Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠ) ----------
DEFAULT_WORDS = [
    "python", "notebook", "dataset", "function", "variable",
    "hangman", "analysis", "feature", "regression", "cluster",
    "spark", "pandas", "numpy", "matplotlib", "database",
    "hadoop", "kafka", "docker", "linux", "yemen"
]

def load_words_from_file(path):
    """
    ÙŠØ­Ù…Ù‘Ù„ ÙƒÙ„Ù…Ø§Øª Ù…Ù† Ù…Ù„Ù Ù†ØµÙŠ (ÙƒÙ„ Ø³Ø·Ø± ÙƒÙ„Ù…Ø©).
    ÙŠØ¹ÙŠØ¯ Ù‚Ø§Ø¦Ù…Ø© ÙƒÙ„Ù…Ø§Øª ØµØ§Ù„Ø­Ø© (Ø­Ø±ÙˆÙ ÙÙ‚Ø·).
    """
    words = []
    try:
        with open(path, "r", encoding="utf-8") as f:
            for line in f:
                w = line.strip().lower()
                # Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ÙƒÙ„Ù…Ø§Øª Ø¹Ø±Ø¨ÙŠØ© Ø£Ùˆ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ù…ÙƒÙˆÙ‘Ù†Ø© Ù…Ù† Ø­Ø±ÙˆÙ ÙÙ‚Ø·
                if w and all(ch.isalpha() or ch == "-" for ch in w):
                    words.append(w)
    except FileNotFoundError:
        return None
    return words or None

def pick_secret_word(words):
    """ÙŠØ®ØªØ§Ø± ÙƒÙ„Ù…Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©."""
    return random.choice(words)

def clear_screen():
    """ÙŠÙ†Ø¸Ù‘Ù Ø§Ù„Ø´Ø§Ø´Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø£Ø¬Ù…Ù„)."""
    if os.name == "nt":
        os.system("cls")
    else:
        os.system("clear")

def display_state(secret, correct_letters, wrong_letters, remaining):
    """ÙŠØ¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©: Ø§Ù„Ø±Ø³Ù…ØŒ Ø§Ù„ÙƒÙ„Ù…Ø© Ù…Ø¹ Ø§Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ù…ÙƒØªØ´ÙØ©ØŒ ÙˆØ§Ù„Ø£Ø®Ø·Ø§Ø¡."""
    stage_index = len(HANGMANPICS) - 1 - remaining
    stage_index = max(0, min(stage_index, len(HANGMANPICS)-1))
    print(HANGMANPICS[stage_index])
    print("\nØ§Ù„ÙƒÙ„Ù…Ø©:")
    revealed = " ".join([ch if ch in correct_letters else "_" for ch in secret])
    print("   ", revealed)
    print("\nØ£Ø®Ø·Ø§Ø¡:", " ".join(sorted(wrong_letters)) if wrong_letters else "Ù„Ø§ ÙŠÙˆØ¬Ø¯")
    print(f"Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: {remaining}")

def get_valid_guess(used_letters, alphabet):
    """
    ÙŠØ·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø­Ø±Ù ØµØ§Ù„Ø­:
    - Ø­Ø±Ù ÙˆØ§Ø­Ø¯
    - Ø­Ø±Ù Ø£Ø¨Ø¬Ø¯ÙŠ
    - ØºÙŠØ± Ù…ÙØ³ØªØ®Ø¯Ù… Ø³Ø§Ø¨Ù‚Ù‹Ø§
    """
    while True:
        guess = input("Ø£Ø¯Ø®Ù„ Ø­Ø±ÙÙ‹Ø§ (letter): ").strip().lower()
        # Ø¯Ø¹Ù… Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ø­Ø±ÙˆÙ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø£Ùˆ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
        if len(guess) != 1:
            print("Ø±Ø¬Ø§Ø¡Ù‹ Ø£Ø¯Ø®Ù„ Ø­Ø±ÙÙ‹Ø§ ÙˆØ§Ø­Ø¯Ù‹Ø§ ÙÙ‚Ø·.")
            continue
        if not guess.isalpha():
            print("Ø±Ø¬Ø§Ø¡Ù‹ Ø£Ø¯Ø®Ù„ Ø­Ø±ÙÙ‹Ø§ Ø£Ø¨Ø¬Ø¯ÙŠÙ‹Ø§.")
            continue
        if guess in used_letters:
            print("Ù‡Ø°Ø§ Ø§Ù„Ø­Ø±Ù Ø¬Ø±Ù‘Ø¨ØªÙ‡ Ù…Ù† Ù‚Ø¨Ù„. Ø¬Ø±Ù‘Ø¨ Ø­Ø±ÙÙ‹Ø§ Ø¢Ø®Ø±.")
            continue
        if alphabet and guess not in alphabet:
            # ÙÙŠ Ø­Ø§Ù„ Ø£Ø±Ø¯Øª ØªÙ‚ÙŠÙŠØ¯ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ù„Ù„Ø§ØªÙŠÙ†ÙŠØ© ÙÙ‚Ø·:
            print("Ø§Ù„Ø­Ø±Ù ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆÙ„Ø©.")
            continue
        return guess

def play_round(words, max_wrong=None):
    """
    ÙŠÙ„Ø¹Ø¨ Ø¬ÙˆÙ„Ø© ÙˆØ§Ø­Ø¯Ø©.
    - max_wrong: Ø£Ù‚ØµÙ‰ Ø¹Ø¯Ø¯ Ø£Ø®Ø·Ø§Ø¡ Ù‚Ø¨Ù„ Ø§Ù„Ø®Ø³Ø§Ø±Ø© (Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§ ÙŠØ³Ø§ÙˆÙŠ Ø·ÙˆÙ„ Ø§Ù„Ø±Ø³ÙˆÙ…Ø§Øª-1)
    """
    secret = pick_secret_word(words)
    # Ù†Ø³Ù…Ø­ Ø¨Ø­Ø±ÙˆÙ Ø¹Ø±Ø¨ÙŠØ©/Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©. Ø¥Ù† Ø­Ø¨ÙŠØª ØªÙ‚ØµØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙÙ‚Ø·ØŒ Ø§Ø³ØªØ®Ø¯Ù… string.ascii_lowercase
    alphabet = None  # Ø£Ùˆ: set(string.ascii_lowercase)
    correct_letters = set()
    wrong_letters = set()

    # Ø£Ù‚ØµÙ‰ Ø£Ø®Ø·Ø§Ø¡ = Ø¹Ø¯Ø¯ Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø±Ø³Ù… - 1 (Ø­ØªÙ‰ Ø¢Ø®Ø± Ø´ÙƒÙ„ Ù‡Ùˆ Ø§Ù„Ø®Ø³Ø§Ø±Ø©)
    if max_wrong is None:
        max_wrong = len(HANGMANPICS) - 1

    remaining = max_wrong

    while remaining >= 0:
        clear_screen()
        display_state(secret, correct_letters, wrong_letters, remaining)

        # Ø­Ø§Ù„Ø© Ø§Ù„ÙÙˆØ²ØŸ
        if all(ch in correct_letters for ch in secret):
            print("\nğŸ‰ ÙÙˆØ²! Ø§ÙƒØªØ´ÙØª Ø§Ù„ÙƒÙ„Ù…Ø©:", secret)
            return True

        # Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø³Ø§Ø±Ø©ØŸ
        if remaining == 0:
            print("\nâŒ Ø®Ø³Ø±Øª! Ø§Ù„ÙƒÙ„Ù…Ø© ÙƒØ§Ù†Øª:", secret)
            return False

        guess = get_valid_guess(used_letters=correct_letters | wrong_letters,
                                alphabet=alphabet)

        if guess in secret:
            correct_letters.add(guess)
        else:
            wrong_letters.add(guess)
            remaining -= 1

def ask_yes_no(prompt):
    """Ø³Ø¤Ø§Ù„ Ù†Ø¹Ù…/Ù„Ø§ Ø¨Ø³ÙŠØ·."""
    while True:
        ans = input(f"{prompt} (y/n): ").strip().lower()
        if ans in ("y", "yes", "Ù†Ø¹Ù…", "Ø§", "Ø§ÙŠÙˆØ§"):
            return True
        if ans in ("n", "no", "Ù„Ø§"):
            return False
        print("ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¨Ù€ y Ø£Ùˆ n.")

def main():
    # Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (6 Ø£Ø®Ø·Ø§Ø¡ Ù…Ù…ÙƒÙ†Ø©)
    max_wrong = len(HANGMANPICS) - 1

    # Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ ÙƒÙ„Ù…Ø§Øª Ù…Ù† Ù…Ù„Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
    # Ø¶Ø¹ Ù…Ù„ÙÙ‹Ø§ Ø¨Ø§Ø³Ù… words.txt ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯ØŒ Ø³Ø·Ø± Ù„ÙƒÙ„ ÙƒÙ„Ù…Ø©.
    words = load_words_from_file("words.txt")
    if not words:
        words = DEFAULT_WORDS

    print("=== Hangman | Ù„Ø¹Ø¨Ø© Ø§Ù„Ø±Ø¬Ù„ Ø§Ù„Ù…Ø´Ù†ÙˆÙ‚ ===")
    print("Ù†ØµØ§Ø¦Ø­:")
    print("- ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ù…Ø§ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© ÙÙŠ Ù…Ù„Ù words.txt (Ø³Ø·Ø± Ù„ÙƒÙ„ ÙƒÙ„Ù…Ø©).")
    print("- ØªØ¯Ø¹Ù… Ù†Ø³Ø®Ù‹Ø§ Ø¹Ø±Ø¨ÙŠØ©/Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ù…Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª.")

    while True:
        _ = play_round(words, max_wrong=max_wrong)
        if not ask_yes_no("ØªÙ„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ØŸ"):
            print("Ù…Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ø© ğŸ‘‹")
            break

if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("\nØªÙ… Ø§Ù„Ø¥Ù†Ù‡Ø§Ø¡.")
        sys.exit(0)
